<!DOCTYPE html>
<html>
  <head>
    <title>The heat equation on the unit disk &raquo; Chebfun</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <link rel="shortcut icon" href="favicon.ico" />

    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet"><!--  media="screen" -->
    <link href="/css/normalize.min.css" rel="stylesheet"><!--  media="screen" -->
    <link href="/css/chebsite.css" rel="stylesheet"><!--  media="screen" -->
    <link href="/css/tomorrow.css" rel="stylesheet"><!--  media="screen" -->
    <link href="/css/flexslider.css" rel="stylesheet"><!--  media="screen" -->

    <link href='https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic' rel='stylesheet' type='text/css'>
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LRD09XBKHN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-LRD09XBKHN');
</script>  </head>
  <body>
    <!-- Fixed navbar -->
    <div id='navbar' class="navbar navbar-default navbar-fixed-top">
      <div class="container nav">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse"><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button>
          <a id="logo" href="/"><img src='/images/logo.png' /></a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="/about">About</a></li>
            <li><a href="/news">News</a></li>
            <li><a href="/download">Download</a></li>
            <li><a href="/docs">Docs</a></li>
            <li><a href="/examples">Examples</a></li>
            <li><a href="/support">Support</a></li>
            <li><a href="/search"><span class="glyphicon glyphicon-search"></span></a></li>
            <li><a href="https://github.com/chebfun/chebfun"><img id='github-logo' src='/css/github-logo.png'/></a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
<div class="page-wrapper">

    <div class='page-header'>
<h1>The heat equation on the unit disk</h1>
<h2>Heather Wilber, January 2017 in <a href='/examples/disk/'>disk</a><span><a href='/examples/disk/HeatEqn.m'>download</a><span class='sep-sm'>&middot;</span><a href='//github.com/chebfun/examples/blob/master/disk/HeatEqn.m'>view on GitHub</a></span></h2>
</div>

    <div class="container">
<div class="row main">
<div id='content' class="col-sm-12 example" role="main">
<h3 id="1-introduction">1. Introduction</h3>
<p>Diskfun includes two built-in fast solvers that can be used to compute solutions to the Possion and Helmholtz equations on the unit disk. In this example, we use an implicit time-stepping scheme and Diskfun's Helmholtz solver to compute the solution to the heat equation.</p>
<h3 id="2-heat-equation-on-the-disk">2. Heat equation on the disk</h3>
<p>The heat equation on the disk is given by $$ u_t =  \alpha \nabla^2 u,  \quad { (x, y), \; x^2 + y^2 \leq 1 }, \quad \quad (1) $$ where $\nabla^2$ is the Laplacian operator, and $\alpha &gt; 0$ is the thermal diffusivity constant. We additionally impose the following boundary and initial conditions on the solution $u$: $$ u(\theta, r, 0) = u_0(\theta, r) \quad \quad u(\theta, 1, t) = g(\theta). \quad \quad (2) $$ Here, $t \geq 0$ represents time, and the spatial components of $u$  are expressed in  polar coordinates, where $\theta \in [-\pi, \pi]$ is the angular variable and $r \in [0, 1]$ is the radial variable.</p>
<h3 id="3-discretization-in-time">3. Discretization in time</h3>
<p>We discretize in time using the second order accurate backward differentiation formula (BDF2). This approximates $u_t$ at $t_n$ as $$ u_t \approx (3u_{n+1} - 4u_{n} + u_{n-1})/(2\Delta t), \quad \quad (3) $$ where $\Delta t$ is the timestep and $u_n(\theta, r, t_n)$ is the (approximate) solution at time $n \Delta t$. Substituting (3) into (1) and solving for $u_{n+1}$ results in the following partial differential equation: $$ 3 u_{n+1} - 2\Delta t \alpha \nabla^2 u_{n+1} = 4 u_{n} - u_{n-1}. \quad \quad (4) $$ This is the Helmholtz equation. We can express (4) in a more conventional form by introducing the constant $K^2 = -3/(2 \Delta t \alpha)$, so that $$ \nabla^2 u_{n+1} + K^2 u_{n+1} = \frac{K^2}{3}(4 u_{n} - u_{n-1}). \quad \quad (5) $$ We can solve for $u_{n+1}$ with the <code>diskfun.helmholtz</code> command.</p>
<h3 id="4-an-example-with-a-known-solution">4. An example with a known solution</h3>
<p>When the initial condition is selected as an eigenfunction of the Laplacian on the disk with Dirichlet boundary conditions, the exact solution to (1) is known. Here, we select the initial condition $u_0$ in (2) to be the sum of two eigenfunctions. Specifically, let $$ u_0(\theta, r) = A_{8,2} J_{8}(\omega_{8,2}r )\cos(8 \theta) + A_{4,4} J_{4}(\omega_{4,4}r )\cos(4 \theta), \quad \quad (6) $$ where $J_m$ is the $m$ th order Bessel function of the first kind, $\omega_{m,n}$ is the $n$ th positive root of $J_m$, and $A_{i,j}$ is a normalization factor. This function is zero on the boundary of the unit disk, so $g$ in (2) is the zero function. We can construct $u_0$ using <code>diskfun.harmonic</code>.</p>
<pre class="mcode-input">u0 = diskfun.harmonic(8,2)+diskfun.harmonic(4,4);

contourf(u0)
title('initial condition')
colormap(hot), colorbar, axis off, caxis([-2,2])</pre>

<p><img src="img/HeatEqn_01.png" class="figure" alt=""></p>
<p>The code below uses the discretization in (5) to numerically compute the solution to (1). To start the method and find $u_1$, we use one step of backward Euler (BDF1). We compute the solution for $0 &lt; t \leq 2$ using a timestep $\Delta t = 0.01$. The roots of the Bessel functions appearing in (6) are required for computing the exact solution. Since we have them, they are also used in this example to define the diffusivity constant $\alpha$. A contour plot of the solution is displayed every 50 timesteps.</p>
<pre class="mcode-input">lam1 = roots(chebfun(@(x) besselj(8,x),[15 17]));
lam2 = roots(chebfun(@(x) besselj(4,x),[16 18]));
alpha = 1/(lam1.^2+lam2.^2);                % diffusion constant
bc = @(t) 0*t;                              % boundary condition
dt = 0.01;                                  % Time step
tfinal = 2;                                 % Stopping time
nsteps = ceil(tfinal/dt);                   % Number of time steps
m = 20;                                     % Spatial discretization
up = u0;                                    % Previous time step

% One step of backward Euler
K = sqrt(1/(dt*alpha))*1i;         % Helmholtz frequency for BDF1
u = diskfun.helmholtz(K^2*up, K, bc, m, m);
K = sqrt(3/(2*dt*alpha))*1i;       % Helmholtz frequency for BDF2
for n = 2:nsteps
    rhs = K^2/3*(4*u - up);
    up = u;
    u = diskfun.helmholtz(rhs, K, bc, m, m);
    % Plot the solution every 50 time steps
    if ( mod(n, 50) == 0 )
        contourf(u), colormap(hot), caxis([-2 2])
        title(sprintf('Time %1.2f',n*dt)), colorbar, axis('off'), snapnow
    end
end</pre>

<p><img src="img/HeatEqn_02.png" class="figure" alt=""></p>
<p><img src="img/HeatEqn_03.png" class="figure" alt=""></p>
<p><img src="img/HeatEqn_04.png" class="figure" alt=""></p>
<p><img src="img/HeatEqn_05.png" class="figure" alt=""></p>
<p>We now compare the true solution at $t=2$ to the above numerical results. The error is primarily induced by the time-stepping scheme, and the spatial discretization has contributed very little additional error.</p>
<pre class="mcode-input">utrue = exp(-lam1^2*alpha*tfinal)*diskfun.harmonic(8,2)+...
        exp(-lam2^2*alpha*tfinal)*diskfun.harmonic(4,4);
norm(u-utrue)</pre>

<pre class="mcode-output">ans =
     5.375213127010716e-06
</pre>

<p>The Helmholtz solver used in Diskfun achieves optimal computational complexity (see [5]), but it also returns the solution as a diskfun at at an additional computational cost. In practice, this is unnecessary, and one can easily modify the solver and gain considerable efficiency by working directly with the 2D Chebyshev-Fourier coefficient matrices associated with the solution at each timestep [5].</p>
<h3 id="5-hot-spots-on-the-edge-of-the-disk">5. Hot spots on the edge of the disk</h3>
<p>In this example, we consider a 2D plate with an initial heat profile $u_0$ consisting of a sum of Gaussian bumps. The absolute maximum of this function occurs in the interior of the plate, but several local maxima occur on the plate's boundary. We construct this function and plot it below.</p>
<pre class="mcode-input">xs = [-1,  0  1,  0];
ys = [ 0, -1  0,  1];
m  = [ 6, 5, 8, 30];

u0 = diskfun( @(x,y) 60*exp(-5*(x+.2).^2 -5*(y+.2).^2) );
for i = 1:4
    u0 = u0 + diskfun(@(x,y) m(i)*exp(-20*(x-xs(i)).^2-20*(y-ys(i)).^2));
end

plot(u0)
axis('off'), colormap(jet), colorbar
title('u0')</pre>

<p><img src="img/HeatEqn_06.png" class="figure" alt=""></p>
<p>The function $u_0(\theta, 1, 0) = g(\theta)$ is the boundary condition that will be imposed on $u$ for all time. We represent $g$ as a periodic chebfun and plot it below. Note that the maximum of $g$ is attained at $\theta = \pi/2$.</p>
<pre class="mcode-input">g = u0(:,1);
plot(g), axis square
title('g(\theta)')</pre>

<p><img src="img/HeatEqn_07.png" class="figure" alt=""></p>
<p>We seek the solution $u$ for all $t \geq 0$. The discretization method described in (4) can be used to compute the time-dependent solution. In the code below, we find the numerical solution for $0 &lt; t \leq 0.2$. As time increases, heat flows toward the hottest spot on the boundary of the disk.</p>
<pre class="mcode-input">dt = 0.01;
tfinal = .2;
nsteps = ceil(tfinal/dt);
m = 128;
alpha = 1.25;
up = u0;
bc = g;
% Do one step of backward Euler
K = sqrt(1/(dt*alpha))*1i;
u = diskfun.helmholtz(K^2*up, K, bc, m,m);
K = sqrt(3/(2*dt*alpha))*1i;
for n = 2:nsteps
    rhs = K^2/3*(4*u - up);
    up = u;
    u = diskfun.helmholtz(rhs, K,bc, m,m);

    % Plot the solution for selected timesteps
    if ( mod(n,5) == 0)
        view([36, 34.4]);
        v = get(gca,'view');
        plot( u ), colormap(jet)
        set(gca,'view',v);
        zlim([0 62])
        title(sprintf('Time %1.2f',n*dt)), colorbar, axis('off'), snapnow
    end
end</pre>

<p><img src="img/HeatEqn_08.png" class="figure" alt=""></p>
<p><img src="img/HeatEqn_09.png" class="figure" alt=""></p>
<p><img src="img/HeatEqn_10.png" class="figure" alt=""></p>
<p><img src="img/HeatEqn_11.png" class="figure" alt=""></p>
<p>At steady-state, $u$ is no longer dependent on $t$ and satisfies Laplace's equation, $\nabla^2 u = 0$. To find the steady-state solution, we use Diskfun's fast Poisson solver.</p>
<pre class="mcode-input">u = diskfun.poisson(diskfun(@(x,y) 0*x), g, m,m)</pre>

<pre class="mcode-output">u =
     diskfun object 
       domain        rank    vertical scale
      unit disk       31           30
</pre>

<p>The steady-state solution satisfies the maximum principle: once $u$ is constant in $t$, the maximum value of $u$ will occur on the boundary of the disk and therefore must agree with the maximum value of $g$. We plot the steady state solution and verify this fact below.</p>
<pre class="mcode-input">plot(u)
colormap(jet)
axis off, view([36, 34.4]), zlim([0, 35])
title('solution u at steady state' )</pre>

<p><img src="img/HeatEqn_12.png" class="figure" alt=""></p>
<pre class="mcode-input">[maxu, locmaxu] = max2(u);
mxu = [maxu cart2pol(locmaxu(1), locmaxu(2)) ]   %maximum at steady state
[maxg, locmaxg] = max(g);
mxg = [maxg locmaxg ]                            %maximum of u0 on boundary</pre>

<pre class="mcode-output">mxu =
  30.036677407858519   1.570857451623678
mxg =
  30.036677407858598   1.570857463287601
</pre>

<p>The value of the steady state solution at $r=0$ is equal to the average temperature on the boundary by the Poisson integral formula [Ch. 4, 1]. We check this property here, finding that at least in this respect, the numerical solution is highly accurate.</p>
<pre class="mcode-input">plot(u(:,0)) %plot of value at r=0
hold on
plot(g)
title('u(\theta, 0) and g(\theta)'), axis square, snapnow
norm(mean(g)-u(0,0))</pre>

<pre class="mcode-output">ans =
     8.881784197001252e-16
</pre>

<p><img src="img/HeatEqn_13.png" class="figure" alt=""></p>
<h3 id="6-extensions">6. Extensions</h3>
<p>The above examples provide a starting point for numerically solving diffusion problems on the disk. These ideas can also be used on the sphere (see chebfun.org/examples/sphere). More information about the underlying methods used in <code>diskfun.poisson</code> and <code>diskfun.helmholtz</code> can be found in [4] and [5]. A more general application of these methods allows one to numerically solve more complicated PDEs, such as a sixth order Navier-Stokes equation that models active biofluids [3]. We hope to expand the capabilities of Diskfun in future releases by providing more tools that are specifically related to numerically solving PDEs on the disk by using more accurate IMEX schemes for time-stepping.</p>
<h3 id="7-references">7. References</h3>
<p>[1] N. H. Asmar, <em>Partial differential equations with Fourier series and boundary value problems</em>, Prentice Hall, 2005.</p>
<p>[2] R. V. Churchill and J. W. Brown, <em>Fourier Series and Boundary Value Problems</em>, McGraw-Hill, 1978.</p>
<p>[3] J. S\l omka, A. Townsend, and J. Dunkel, Stokes II
problem and Einstein-de Haas effect in active fluids, in preparation,
2017.</p>
<p>[4] H. Wilber, A. Townsend, and G. B. Wright, Computing with functions in spherical and polar geometries II. The disk, <em>SIAM J. Sci. Comput.</em>, submitted, 2016.</p>
<p>[5] H. Wilber, Numerical computing with functions on the sphere and disk, <em>Masters thesis</em>, Boise State University, 2016.</p></div>
        </div>
    </div>
</div>
    <div class="footer">
        <p>&copy; Copyright 2025 the University of Oxford and the Chebfun Developers.</p>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.7.2.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?lang=matlab" type="text/javascript"></script>
    <script type="text/javascript" src="/js/config.js"></script>
    <script type="text/javascript" src="/js/jquery.flexslider-min.js"></script>
  </body>
</html>